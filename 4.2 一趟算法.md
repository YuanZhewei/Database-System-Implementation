## 一趟算法

操作符的各种算法主要分为三类

1. 基于排序的算法
2. 基于散列的算法
3. 基于索引的算法

基于难度和代价可以分为三种等级
1. 一些算法仅从磁盘读取一次数据，这就是一趟算法。一趟算法通常要求操作的至少一个操作对象可以完全装入内存，也有例外，例如选择和投影
2. 一些方法处理的数据量太大以至于不可能完全装入内存，但是又不是可想象的最大的数据集合。两趟算法的特点是先从磁盘读一遍数据，用某种方式处理，将全部或绝大部分写回磁盘，然后在第二趟中为了进一步处理，再读一遍数据
3. 某些方法对处理的数据量没有限制。这些方法使用三趟或者更多趟来完成工作，他是对两趟算法的自然的递归的推广

操作符分为三大类：

|     一次单个元祖，一元操作     |          整个关系，一元操作          |                      整个关系，二元操作                      |
| :----------------------------: | :----------------------------------: | :----------------------------------------------------------: |
|     选择$\sigma$ 投影$\pi$     |      分组$\gamma$ 去重$\delta$       |        其他操作符$\cup \ \cap\  \Join\ \times \theta$        |
| 不需要一次在内存中装入整个关系 | 需要一次从内存中看到所有或大部分元组 | 如果使用一趟算法，这类操作中的每一个都要求至少一个操作对象的大小限制在$M$以下 |

### 一次单个元组操作的一趟算法

如果$R$是聚集的代价就是$B$，若果$R$不是聚集的，代价就是$T$

### 整个关系的一元操作的一趟算法

#### 消除重复

用一个内存缓冲区保存$R$的元组的一个块，其余的$M-1$个缓冲区可以用来保存目前为止我们见过的每个元组的一个副本。
$$
B(\delta(R)) \le M
$$

#### 分组
$$
B(\gamma(R)) \ll M
$$

###二元操作的一趟算法

$$
min(B(R), B(S)) \le M
$$

假设$R$是两个关系中较大的一个，并且我们把$S$放在内存中
####集合并
将$S$读到内存的$M-1$个缓冲区中并且建立一个查找结构，其查找关键字是整个元组。所有这些元组也复制到输出。然后将$R$中的每一个块读到第$M$个缓冲区。对于$R$的每一个元组，检查$t$是否在$S$中，如果不在，将$t$复制到输出。如果在，跳过$t$。
####集合交
与集合并相同，输出时不同。
####集合差
差不是可交换的需要区别$R-_sS$和$S-_sR$，读取$S$到$M-1$个缓冲区中并建立将整个元组做为关键字的查找结构。
* $R-_sS$  读取$R$中的每一个块并检查块中的每个元组$t$。如果$t$在$S$中，那么忽略$t$；如果$t$不在$S$中，则将$t$复制到输出。
* $S-_sR$ 读取$R$中的每一块，并依次检查每一个元组$t$。如果$t$在$S$中，那么从主存中$S$的副本里删掉$t$，如果$t$不在$S$中，则不做任何处理。
### 包交
将$S$读取到$M-1$个缓冲区中，将每个元组计数。读取$R$的每一个块，检查$t$是否在$S$中出现。如果不出现，则忽略。如果$t$在$S$中出现，并且与$t$对应的计数仍未正值，那我们输出$t$并将计数减1。
### 包差
* $S-_BR$ 将$S$读到内存中，统计每个元组的个数。读取$R$时，对每一个元组$t$观察是否在$s$中出现，如果出现，将计数减1，最后将内存中计数为正数的元组输出，并且按次数复制
* $R-_BS$将$S$读到内存中，统计每个元组的个数。读取$R$时，对每一个元组$t$观察是否在$s$中出现，如果不出现，则输出$t$，如果出现，检查当前计数值$c$，如果$c > 0$，将$c$减1，如果$c = 0$，输出$t$
### 积

将$S$读入到主存的$M-1$个缓冲区中，然后读取$R$的每一个块，并且对$R$中每一个元组$t$，将$t$与$S$中的每一个元组连接。在每一个连接而成的元组一形成后将其输出。

### 自然连接

$R(X,Y) \Join S(Y,Z)$

1. 读取$S$的所有元组，并且用他们构造一个以$Y$属性为查找关键字的内存查找结构，放入$M-1$个块中
2. 将$R$的每一块读取到内存剩下的那个缓冲区中，对于$R$的每一个元组$t$，利用查找结构找到$S$中与$t$中在$Y$的所有属性上相符合的元组。对于$S$中的每一个匹配的元组，将其与$t$连接后形成一个元组，并且将结果输出到输出