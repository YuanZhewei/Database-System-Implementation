当对由给定逻辑计划导出的可能的物理计划进行枚举时，我们为每个物理计划进行如下选择

* 满足结合律与分配律的运算，如连接、并、交的次序与分组。

* 在逻辑计划中每个运算符的算法，例如，决定使用嵌套循环连接或散列连接。

* 其他运算符，如扫描、排序等，他们是物理计划所需要的但在逻辑计划中都不显式地存在。

* 参数从一个运算符传送到下一个运算符的方式。例如，通过在磁盘上保存的中间结果或者通过使用迭代器并每次传送一个参数的一个元组或一个主存缓冲区。

### 中间关系大小的估计
估算规则应满足：
* 准确的估计
* 易于计算
* 逻辑上一致
### 投影运算大小的估计
包的投影大小可以精确计算，扩展投影由于产生了新的成分，可能增大了关系的大小。
### 选择运算大小的估计
令$S =  \sigma_{A=c}(R)$，其中$A$是$R$的属性，$c$是一个常量。

* $T(S) = \frac {T(R)} {V(R, A)}$

如果$S=\sigma_{A < c}(R)$

* $T(S) = \frac {T(R)} {3}$

如果$S = \sigma_{A \ne c}(R)$

* $T(S) = T(R)$或$T(S) = T(R) \frac{V(R, a) - 1} {V(R, a)}$

当选择条件C是多个等值与不等值比较的AND时，我们可以把选择$\sigma_C(R)$作为多个简单选择的级联，其中每一个选择只检查其中一个的条件

例 令$R(a, b, c)$是一个关系，$S = \sigma_{a = 10 \ AND\  b < 20}(R)$。同时，令$T(R) = 10000$，$V(R, a) = 50$。则$T(S) = \frac {T(R)} {50 \times 3} = 67$

$S = \sigma_{C_1\ OR\ C_2}(R)$，如果$R$有$n$个元组，其中$m_1$满足$C_1$，有$m_2$个满足$C_2$，我们估计S中元组的数目为：

$n(1 - (1 - \frac{m_1}{n})(1 - \frac{m_2}{n}))$

例 假设$R(a, b)$有$T(R) = 10000$个元组，且$S=\sigma_{a=10\ OR\ b < 20}(R)$，令$V(R, a) = 50$，则满足$a = 10$的元组数估计为$200$，满足$b < 20$的元组数我们估计为$\frac{T(R)} {3} = 3333 $，则$T(S) = 10000(1 - \frac{200}{10000})(1-\frac{3333}{10000}) = 3466$

###连接运算大小的估计
$R(X, Y) \Join R(Y, Z)$，初步我们假设$Y$是单个属性
1. 两个关系可能有不相交的$Y​$值集合，在这种情况下，连接是一个空集且$T(R \Join S) = 0​$
2. $Y$可能是$S$的键并且是$R$的外键，因此$R$的每个元组正好与$S$中的一个元组连接，且$T(R \Join S) = T(R)$
3. 几乎所有$S$与$R$的元组都具有相同的$Y$值，在这种情况下，$T(R \Join S) \approx T(R)T(S)$

针对最通用的情形，我们做两个简化的假设：
* 值集的包含。如果$Y$是出现在多个关系的一个属性，则每个关系从值$y_1, y_2, \cdots$的一个固定列表的前头选择其值并且取尽前面的所有值。因此，如果$R$与$S$是具有属性$Y$的两个关系，且$V(R, Y) \le V(S, Y)$，则$R$的每个$Y$值将是$S$的一个$Y$值。
* 值集的保持。如果我们把关系$R$与另一个关系连接，则不是连接属性的属性$A$不会在其可能的值集中丢失值。更准确地说，如果$A$是$R$的一个属性但不是$S$的属性，则 $V(R \Join S, A)=V(R, A)$

  假设(1)很显然会被违反，但当$Y$是$S$中的键且是$R$中的外键时，假设(1)是满足的。在许多其他情况也近似为真，因为直觉上我们预期，如果$S$有许多$Y$值，则一个出现在$R$中的给定$Y$值有较大的机会出现在$S$中。
  
  假设(2)也可能被违反，但当$R \Join S$的连接属性是$S$的键也是$R$的外键时为真。事实上，(2)被违反只有当$R$中存在“悬挂元组”，即$R$中不与$S$中的元组相连接的元组；并且即便$R$中存在“悬挂数组”，该假设也可能仍然成立。
  
  在这些假设下，我们可以对$R(X, Y) \Join S(Y, Z)$的大小做如下估计。设$r$是$R$中的一个元组，$s$是$S$中的一个元组。$r$和$s$在属性上相等的概率是多少？假定$V(R, Y) \ge V(S, Y)$。由值集的包含假定，则$s$的$Y$值肯定出现在$R$的$Y$值当中。因此$r$有和$s$相同的$Y$值的概率为$\frac{1}{V(R, Y)}$。类似地，如果$V(R, Y)  < V(S, Y)$，那么$r$的$Y$值将会出现在$S$中，并且有$\frac{1}{V(S, y)}$的概率$r$和$s$有相同的$Y$值。一般而言，在$Y$中相等的概率为$\frac{1}{max(V(R, Y), V(S, Y))}$因此
* $T(R \Join S) = \frac {T(R)T(S)}{max(V(R, Y), V(S, Y))}$

例：考虑如下三个关系及其重要统计值

|$R(a, b)$|$S(b, c)$|$U(c, d)$|
|:--:|:---:|:--:|
|$T(R) = 1000$|$T(S)=2000$|$T(U)=5000$|
|$V(R, b) = 20$|V(S, b) = 50||
||$V(S, c)=100$|$V(U,c)=500$|

$$
R \Join S \Join U \\
\Downarrow \\
(R \Join S) \Join U \\
T(R \Join S) = \frac {R \Join S} {max(V(R,b), V(S, b))} = 1000 \times 2000 \div 50 = 40000 \\
T((R \Join S)\Join U) = \frac {T(R \Join S)T(U)} {max(V(R \Join S, c), V(U, c))} = 40000 \times 5000 \div 500 = 400000
$$

###多连接属性的自然连接
当连接$R(X, Y) \Join S(Y, Z)$中的属性集$Y$包含多于一个属性时，我们在用一个$Y$属性进行连接时的参数被应用到每个属性上
* $T(R \Join S) = \frac {T(R)T(S)}{\prod_1^nmax(V(R, y), V(S, y))}$

### 多个关系的连接

考虑自然连接的一般情形：

$S = R_1 \Join R_2 \Join \cdots \Join R_n$
假设属性A出现在$k$个$R_i$中，在这$k$个关系中值的集合的个数(即$V(R_i, A)$的各个值，其中$i = 1, 2, \cdots, k$，则所有$k$个元组在$A$上相同的概率是积$\prod_2^k \frac {1}{v_k}$

例： 考虑连接$R(a, b, c) \Join S(b, c, d) \Join U(b, e)$

|   $R(a,b,c)$    | $S(b, c, d)$  |  $U(b, e)$   |
| :-------------: | :-----------: | :----------: |
|  $T(R) = 1000$  | $T(S) = 2000$ | $T(U)=5000$  |
| $V(R, a) = 100$ |               |              |
|  $V(R, b)=20$   | $V(S, b)=50$  | $V(U,b)=200$ |
|  $V(R, c)=200$  | $V(S,c)=100$  |              |
|                 | $V(S,d)=400$  |              |
|                 |               | $V(U,e)=500$ |

$$
R(a, b, c) \Join S(b, c, d) \Join U(b, e) \\
\Downarrow \\
\frac {T(R)T(S)T(U)} {V(S,b)V(U,b)V(R,c)} \\
\Downarrow \\
 1000 \times 2000 \times 5000 \div (50 \times 200 \times 200) = 5000
$$

###其他运算大小的估计

####并
* 包的并 $T(R \cup S) = T(R) + T(S)$
* 集合的并 $T(R \cup S) = T(R)\ or \  T(S) \  or \ \frac {T(R) + T(S)} {2}$
####交
* $T(R \cap S) \in [0, max(T(R), T(S))]$，平均值$\frac {max(T(R), T(S))} {2}$
####差
* $T(R - S) \in [T(R) - T(S), T(R)]$，平均值$T(R) - \frac{T(S)}{2}$
####消除重复
* 若$R(a_1, a_2, \cdots, a_n)$是一关系，则$V(R, [a_1, a_2, \cdots, a_n])$的大小为$\delta(R)$。通常我们取不到这个统计值，所以取近似值
* $\delta(R) \in [1,  T(R)]$
* $\delta(R) \le \prod_1^n V(R, a_i)$
* 合理的估计是$min(\frac {T(R)}{2}, \prod_1^n V(R, a_i))$

####分组与聚集

* 假设我们有一个表达式$\gamma_L(R)$。若统计值$V(R, [g_1, g_2, \cdots, g_k])$已知，其中$g_i$是$L$中的分组属性，就是我们要的答案。通常这个统计值我们取不到，所以取近似值
* $\gamma_L(R) \in [1, T(R)]$
* $\gamma_L(R) \le \prod_1^n V(R, g_i)$
* 合理的估计值是$min(\frac {T(R)}{2}, \prod_1^n V(R, g_i))$